# note: export $TOOLKIT (path/to/current_repo) into env
# e.g. export TOOLKIT=$(dirname $(dirname $BASH_SOURCE[0]))
export GITHUB=$(dirname $TOOLKIT)
export PATHbashaliasglobal="$TOOLKIT/dotfiles/.bash_aliases_global"
alias cdtoolkit="cd $TOOLKIT"
alias cdgh="cd $GITHUB"

# shortcuts
alias bashrc='vim ~/.bashrc'
alias sourcebash='source ~/.bashrc'
alias bashalias='vim ~/.bash_aliases'
alias bashaliasglobal="vim $TOOLKIT/dotfiles/.bash_aliases_global"
alias vimrc='vim ~/.vimrc'
alias tldr='tldr -t ocean'
alias cl='clear'
alias myip='curl http://ipecho.net/plain; echo'

# easier navigation
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."

# git
alias gadcm='git add -A && git commit -m'
alias gupignore='git rm -r --cached . ; git add . &&  git commit -m "update .gitignore"'

# some simple functions
mks() {
	# make a runnable script
	if [ ! -f $1 ]; then
		echo "#!/usr/bin/env ${2:-bash}" >$1
		chmod 755 $1
	else
		echo "$1 already exists!"
	fi
}

datename() {
	# attach date to the name of a file as a copy
	cp $1 "${2:-$(dirname $1)}/$(date -I)_$(basename $1)"
}

extname() {
	# get the extension of a filename
	basename $1 | sed 's/.*\.\(.*\)/\1/'
}

barename() {
	# get the bare name of a filename
	basename $1 | sed 's/\(.*\)\..*/\1/'
}

wgetext() {
	# download a files with specific $1::extension from $2::url
	wget -r -np -nc -nd -A $1 $2
}

# julia
alias plutorun="julia -e 'using Pluto; Pluto.run()'"
jlinstall() {
	# install julia
	local PATH_DOWNLOAD="$HOME/Downloads"
	local PATH_USRBIN="/usr/local/bin"
	local DIR_INSTALL="/opt"
	local tarball="julia-$1-linux-x86_64.tar.gz"
	local linkDownload="https://julialang-s3.julialang.org/bin/linux/x64/${1:0:3}/$tarball"

	echo "downloading the julia tar-ball:"
	wget --directory-prefix $PATH_DOWNLOAD $linkDownload
	echo ":) download finished!"

	echo ">>> unpacking tarball to $DIR_INSTALL :"
	sudo tar -xvzf "$PATH_DOWNLOAD/$tarball" --directory=$DIR_INSTALL
	echo ":) julia tarball unpacked at $DIR_INSTALL/julia-$1/ !"

	echo "creating symbolic link"
	sudo ln -s "$DIR_INSTALL/julia-$1/bin/julia" "$PATH_USRBIN/julia$1"
	# replace the default julia command
	if [ -n "$2" ]; then
		sudo rm "$PATH_USRBIN/$2"
		sudo ln -s "$DIR_INSTALL/julia-$1/bin/julia" "$PATH_USRBIN/$2"
	fi
	echo ":) symbolic links created!"

	echo "removing the downloaded tarball"
	rm "$PATH_DOWNLOAD/$tarball"
	echo ":) tarball removed!"

	if [ -n "$2" ]; then
		echo ":) All finished!!! Please check by running: julia$1 or $2 "
	else
		echo ":) All finished!!! Please check by running: julia$1 "
	fi
}

jluninstall() {
	# remove julia
	local PATH_USRBIN="/usr/local/bin"
	local DIR_INSTALL="/opt"

	sudo rm -rf "$DIR_INSTALL/julia-$1"
	echo "installation dir: $DIR_INSTALL/julia-$1 removed!"

	sudo rm "$PATH_USRBIN/julia$1"
	echo "symbolic link: $PATH_USRBIN/julia$1 removed!"
}

jlsetbin() {
	# set the command link 'julia'
	local PATH_USRBIN="/usr/local/bin"
	local DIR_INSTALL="/opt"

	sudo rm "$PATH_USRBIN/julia"
	sudo ln -s "$DIR_INSTALL/julia-$1/bin/julia" "$PATH_USRBIN/julia"

	echo "Please check by running: julia"
}

# latex
edbib() {
	jabref ${1:-$TOOLKIT/tex/bib/global.bib}
}

upbib() {
	local defaultPath=$(pwd)
	if [ -n "$1" ]; then
		local pathbib="${2:-$defaultPath}/$1"
	else
		local namebib=$(basename $(ls ${2:-$defaultPath}/*.tex) | sed 's/\(.*\)\..*/\1/')
		local pathbib="${2:-$defaultPath}/$namebib.bib"
	fi
	cp $TOOLKIT/tex/bib/global.bib $pathbib
}

texindent() {
	# autoindent .tex files
	/usr/bin/find $1 -name '*.tex' -exec latexindent -w -s {} \;
}

texrmbak() {
	# remove *.bak* files
	/usr/bin/find $1 -name '*.bak*' -exec rm {} \;
}

texclean() {
	# remove auxilary files except .tex & .bib
	/usr/bin/find $1 -type f -not \( -name '*.tex' -or -name '*.bib' -or -name '*.pdf' \) -delete
}

mkmytex() {
	# create a .tex from myarticle.tex
	local default3=$(pwd)
	local default2=$(basename $default3)
	for extTmp in tex bib; do
		if [[ -f "$TOOLKIT/tex/my$1/my$1.$extTmp" ]]; then
			cp $TOOLKIT/tex/my$1/my$1.$extTmp ${3:-$default3}/${2:-$default2}.$extTmp
			# update the name of .bib file in .tex
			if [[ "$extTmp" = 'bib' ]]; then
				sed -i "s/bibliography{my$1}/bibliography{${2:-$default2}}/g" ${3:-$default3}/${2:-$default2}.tex
				# remove the cr (^m) if on dos
				if [[ $(uname) -ne 'linux' ]] && [[ $(uname) -ne 'darwin' ]]; then
					dos2unix.exe ${3:-$default3}/${2:-$default2}.tex
				fi
				# update .bib with global .bib
				cp $TOOLKIT/tex/bib/global.$extTmp ${3:-$default3}/${2:-$default2}.$extTmp
			fi
		fi
	done
}

# github
ghtree() {
	# tree cmd to markdown with links
	local tree=$(tree -tf --noreport -I '*~' --charset ascii $1 |
	sed -e 's/| \+/  /g' -e 's/[|`]-\+/ */g' -e 's:\(* \)\(\(.*/\)\([^/]\+\)\):\1[\4](\2):g' -e 's/\*/\-/g')
	if [ "$2" = "git" ]; then
		echo "$tree" | sed '/.git/d'
	else
		echo "$tree"
	fi
}
